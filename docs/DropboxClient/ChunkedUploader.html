<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta content="text/html; charset=UTF-8" http-equiv="Content-Type" />

  <title>Class: DropboxClient::ChunkedUploader</title>

  <link rel="stylesheet" href="../rdoc.css" type="text/css" media="screen" />

  <script src="../js/jquery.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/thickbox-compressed.js" type="text/javascript" charset="utf-8"></script>
  <script src="../js/quicksearch.js" type="text/javascript" charset="utf-8"></script>

</head>
<body id="top" class="class">

  <div id="metadata">
    <div id="home-metadata">
      <div id="home-section" class="section">
        <h3 class="section-header">
          <a href="../index.html">Home</a>
          <a href="../index.html#classes">Classes</a>
          <a href="../index.html#methods">Methods</a>
        </h3>
      </div>
    </div>

    <div id="file-metadata">
      <div id="file-list-section" class="section">
        <h3 class="section-header">In Files</h3>
        <div class="section-body">
          <ul>
          
            <li><a href="../build/dropbox-ruby-sdk-1_6_2/lib/dropbox_sdk_rb.html?TB_iframe=true&amp;height=550&amp;width=785"
              class="thickbox" title="build/dropbox-ruby-sdk-1.6.2/lib/dropbox_sdk.rb">build/dropbox-ruby-sdk-1.6.2/lib/dropbox_sdk.rb</a></li>
          
          </ul>
        </div>
      </div>

      
    </div>

    <div id="class-metadata">
      
      <!-- Parent Class -->
      <div id="parent-class-section" class="section">
        <h3 class="section-header">Parent</h3>
        
        <p class="link">Object</p>
        
      </div>
      

      

      

      
      <!-- Method Quickref -->
      <div id="method-list-section" class="section">
        <h3 class="section-header">Methods</h3>
        <ul class="link-list">
          
          <li><a href="#method-c-new">::new</a></li>
          
          <li><a href="#method-i-finish">#finish</a></li>
          
          <li><a href="#method-i-upload">#upload</a></li>
          
        </ul>
      </div>
      

      
    </div>

    <div id="project-metadata">
      
      

      <div id="classindex-section" class="section project-section">
        <h3 class="section-header">Class/Module Index
          <span class="search-toggle"><img src="../images/find.png"
            height="16" width="16" alt="[+]"
            title="show/hide quicksearch" /></span></h3>
        <form action="#" method="get" accept-charset="utf-8" class="initially-hidden">
        <fieldset>
          <legend>Quicksearch</legend>
          <input type="text" name="quicksearch" value=""
            class="quicksearch-field" />
        </fieldset>
        </form>

        <ul class="link-list">
        
          <li><a href="../DropboxOAuth2Flow.html">DropboxOAuth2Flow</a></li>
        
          <li><a href="../DropboxOAuth2Flow/BadRequestError.html">DropboxOAuth2Flow::BadRequestError</a></li>
        
          <li><a href="../DropboxOAuth2Flow/BadStateError.html">DropboxOAuth2Flow::BadStateError</a></li>
        
          <li><a href="../DropboxOAuth2Flow/CsrfError.html">DropboxOAuth2Flow::CsrfError</a></li>
        
          <li><a href="../DropboxOAuth2Flow/NotApprovedError.html">DropboxOAuth2Flow::NotApprovedError</a></li>
        
          <li><a href="../DropboxOAuth2Flow/ProviderError.html">DropboxOAuth2Flow::ProviderError</a></li>
        
          <li><a href="../DropboxClient.html">DropboxClient</a></li>
        
          <li><a href="../DropboxClient/ChunkedUploader.html">DropboxClient::ChunkedUploader</a></li>
        
          <li><a href="../DropboxAuthError.html">DropboxAuthError</a></li>
        
          <li><a href="../DropboxError.html">DropboxError</a></li>
        
          <li><a href="../DropboxNotModified.html">DropboxNotModified</a></li>
        
          <li><a href="../DropboxOAuth2FlowNoRedirect.html">DropboxOAuth2FlowNoRedirect</a></li>
        
        </ul>
        <div id="no-class-search-results" style="display: none;">No matching classes.</div>
      </div>

      
    </div>
  </div>

  <div id="documentation">
    <h1 class="class">DropboxClient::ChunkedUploader</h1>

    <div id="description" class="description">
      
<p><a href="ChunkedUploader.html">ChunkedUploader</a> is responsible for
uploading a large file to Dropbox in smaller chunks. This allows large
files to be uploaded and makes allows recovery during failure.</p>

    </div><!-- description -->

    
    
    
    <div id="5Buntitled-5D" class="documentation-section">
      

      

      

      
      <!-- Attributes -->
      <div id="attribute-method-details" class="method-section section">
        <h3 class="section-header">Attributes</h3>

        
        <div id="client-attribute-method" class="method-detail">
          <a name="client"></a>
          
          <a name="client="></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">client</span><span
              class="attribute-access-type">[RW]</span>
          </div>

          <div class="method-description">
          
          
          
          </div>
        </div>
        
        <div id="file_obj-attribute-method" class="method-detail">
          <a name="file_obj"></a>
          
          <a name="file_obj="></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">file_obj</span><span
              class="attribute-access-type">[RW]</span>
          </div>

          <div class="method-description">
          
          
          
          </div>
        </div>
        
        <div id="offset-attribute-method" class="method-detail">
          <a name="offset"></a>
          
          <a name="offset="></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">offset</span><span
              class="attribute-access-type">[RW]</span>
          </div>

          <div class="method-description">
          
          
          
          </div>
        </div>
        
        <div id="total_size-attribute-method" class="method-detail">
          <a name="total_size"></a>
          
          <a name="total_size="></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">total_size</span><span
              class="attribute-access-type">[RW]</span>
          </div>

          <div class="method-description">
          
          
          
          </div>
        </div>
        
        <div id="upload_id-attribute-method" class="method-detail">
          <a name="upload_id"></a>
          
          <a name="upload_id="></a>
          
          <div class="method-heading attribute-method-heading">
            <span class="method-name">upload_id</span><span
              class="attribute-access-type">[RW]</span>
          </div>

          <div class="method-description">
          
          
          
          </div>
        </div>
        
      </div><!-- attribute-method-details -->
      

      <!-- Methods -->
      
      <div id="public-class-method-details" class="method-section section">
        <h3 class="section-header">Public Class Methods</h3>

      
        <div id="new-method" class="method-detail ">
          <a name="method-c-new"></a>

          
          <div class="method-heading">
            <span class="method-name">new</span><span
              class="method-args">(client, file_obj, total_size)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            
            

            
            <div class="method-source-code" id="new-source">
<pre>
<span class="ruby-comment"># File build/dropbox-ruby-sdk-1.6.2/lib/dropbox_sdk.rb, line 777</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">client</span>, <span class="ruby-identifier">file_obj</span>, <span class="ruby-identifier">total_size</span>)
    <span class="ruby-ivar">@client</span> = <span class="ruby-identifier">client</span>
    <span class="ruby-ivar">@file_obj</span> = <span class="ruby-identifier">file_obj</span>
    <span class="ruby-ivar">@total_size</span> = <span class="ruby-identifier">total_size</span>
    <span class="ruby-ivar">@upload_id</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-ivar">@offset</span> = <span class="ruby-value">0</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- new-source -->
            
          </div>

          

          
        </div><!-- new-method -->

      
      </div><!-- public-class-method-details -->
    
      <div id="public-instance-method-details" class="method-section section">
        <h3 class="section-header">Public Instance Methods</h3>

      
        <div id="finish-method" class="method-detail ">
          <a name="method-i-finish"></a>

          
          <div class="method-heading">
            <span class="method-name">finish</span><span
              class="method-args">(to_path, overwrite=false, parent_rev=nil)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Completes a file upload</p>

<p>Args:</p>
<ul><li>
<p><tt>to_path</tt>: The directory path to upload the file to. If the
destination directory does not yet exist, it will be created.</p>
</li><li>
<p><tt>overwrite</tt>: Whether to overwrite an existing file at the given
path. [default is False] If overwrite is False and a file already exists
there, Dropbox will rename the upload to make sure it doesn't overwrite
anything. You must check the returned metadata to know what this new name
is. This field should only be True if your intent is to potentially clobber
changes to a file that you don't know about.</p>
</li><li>
<p>parent_rev: The rev field from the ‘parent’ of this upload. If your intent
is to update the file at the given path, you should pass the parent_rev
parameter set to the rev value from the most recent metadata you have of
the existing file at that path. If the server has a more recent version of
the file at the specified path, it will automatically rename your uploaded
file, spinning off a conflict. Using this parameter effectively causes the
overwrite parameter to be ignored. The file will always be overwritten if
you send the most-recent parent_rev, and it will never be overwritten you
send a less-recent one.</p>
</li></ul>

<p>Returns:</p>
<ul><li>
<p>A Hash with the metadata of file just uploaded. For a detailed description
of what this call returns, visit: <a
href="https://www.dropbox.com/developers/reference/api#metadata">www.dropbox.com/developers/reference/api#metadata</a></p>
</li></ul>
            

            
            <div class="method-source-code" id="finish-source">
<pre>
<span class="ruby-comment"># File build/dropbox-ruby-sdk-1.6.2/lib/dropbox_sdk.rb, line 841</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">finish</span>(<span class="ruby-identifier">to_path</span>, <span class="ruby-identifier">overwrite</span>=<span class="ruby-keyword">false</span>, <span class="ruby-identifier">parent_rev</span>=<span class="ruby-keyword">nil</span>)
    <span class="ruby-identifier">response</span> = <span class="ruby-ivar">@client</span>.<span class="ruby-identifier">commit_chunked_upload</span>(<span class="ruby-identifier">to_path</span>, <span class="ruby-ivar">@upload_id</span>, <span class="ruby-identifier">overwrite</span>, <span class="ruby-identifier">parent_rev</span>)
    <span class="ruby-constant">Dropbox</span><span class="ruby-operator">::</span><span class="ruby-identifier">parse_response</span>(<span class="ruby-identifier">response</span>)
<span class="ruby-keyword">end</span></pre>
            </div><!-- finish-source -->
            
          </div>

          

          
        </div><!-- finish-method -->

      
        <div id="upload-method" class="method-detail ">
          <a name="method-i-upload"></a>

          
          <div class="method-heading">
            <span class="method-name">upload</span><span
              class="method-args">(chunk_size=4*1024*1024)</span>
            <span class="method-click-advice">click to toggle source</span>
          </div>
          

          <div class="method-description">
            
            <p>Uploads data from this ChunkedUploader’s <a
href="ChunkedUploader.html#attribute-i-file_obj">file_obj</a> in chunks,
until an error occurs. Throws an exception when an error occurs, and can be
called again to resume the upload.</p>

<p>Args:</p>
<ul><li>
<p><tt>chunk_size</tt>: The chunk size for each individual upload.  Defaults
to 4MB.</p>
</li></ul>
            

            
            <div class="method-source-code" id="upload-source">
<pre>
<span class="ruby-comment"># File build/dropbox-ruby-sdk-1.6.2/lib/dropbox_sdk.rb, line 791</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">upload</span>(<span class="ruby-identifier">chunk_size</span>=<span class="ruby-value">4</span>*<span class="ruby-value">1024</span>*<span class="ruby-value">1024</span>)
    <span class="ruby-identifier">last_chunk</span> = <span class="ruby-keyword">nil</span>

    <span class="ruby-keyword">while</span> <span class="ruby-ivar">@offset</span> <span class="ruby-operator">&lt;</span> <span class="ruby-ivar">@total_size</span>
        <span class="ruby-keyword">if</span> <span class="ruby-keyword">not</span> <span class="ruby-identifier">last_chunk</span>
            <span class="ruby-identifier">last_chunk</span> = <span class="ruby-ivar">@file_obj</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">chunk_size</span>)
        <span class="ruby-keyword">end</span>

        <span class="ruby-identifier">resp</span> = {}
        <span class="ruby-keyword">begin</span>
            <span class="ruby-identifier">resp</span> = <span class="ruby-constant">Dropbox</span><span class="ruby-operator">::</span><span class="ruby-identifier">parse_response</span>(<span class="ruby-ivar">@client</span>.<span class="ruby-identifier">partial_chunked_upload</span>(<span class="ruby-identifier">last_chunk</span>, <span class="ruby-ivar">@upload_id</span>, <span class="ruby-ivar">@offset</span>))
            <span class="ruby-identifier">last_chunk</span> = <span class="ruby-keyword">nil</span>
        <span class="ruby-keyword">rescue</span> <span class="ruby-constant">DropboxError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">e</span>
            <span class="ruby-identifier">resp</span> = <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">e</span>.<span class="ruby-identifier">http_response</span>.<span class="ruby-identifier">body</span>)
            <span class="ruby-identifier">raise</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">resp</span>.<span class="ruby-identifier">has_key?</span> <span class="ruby-string">'offset'</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-keyword">if</span> <span class="ruby-identifier">resp</span>.<span class="ruby-identifier">has_key?</span> <span class="ruby-string">'offset'</span> <span class="ruby-keyword">and</span> <span class="ruby-identifier">resp</span>[<span class="ruby-string">'offset'</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@offset</span>
            <span class="ruby-ivar">@offset</span> <span class="ruby-operator">+=</span> (<span class="ruby-identifier">resp</span>[<span class="ruby-string">'offset'</span>] <span class="ruby-operator">-</span> <span class="ruby-ivar">@offset</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">resp</span>[<span class="ruby-string">'offset'</span>]
            <span class="ruby-identifier">last_chunk</span> = <span class="ruby-keyword">nil</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-ivar">@upload_id</span> = <span class="ruby-identifier">resp</span>[<span class="ruby-string">'upload_id'</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">resp</span>[<span class="ruby-string">'upload_id'</span>]
    <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
            </div><!-- upload-source -->
            
          </div>

          

          
        </div><!-- upload-method -->

      
      </div><!-- public-instance-method-details -->
    
    </div><!-- 5Buntitled-5D -->
  

  </div><!-- documentation -->

  <div id="validator-badges">
    <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
    <p><small>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish
      Rdoc Generator</a> 2</small>.</p>
  </div>

</body>
</html>

